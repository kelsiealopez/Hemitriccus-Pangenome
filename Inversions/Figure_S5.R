# Clean script for inversion discovery summary with UpSet plot and colored histograms

# Libraries

library(ggplot2)
library(dplyr)
library(tidyr)
library(UpSetR)

# read Data
data <- data.frame(
  Size = c(827,
           270,
           369,
           1594,
           63,
           507,
           1499,
           500,
           7954,
           185212,
           16425,
           1038,
           811,
           3844,
           366,
           102929,
           2572,
           23310,
           965,
           432,
           500,
           151,
           1039,
           455,
           1210,
           313,
           1380,
           2376,
           14448,
           4084,
           35086,
           12993,
           345,
           3500,
           1951,
           831,
           2229,
           842,
           51101,
           5014,
           3688,
           1692,
           3044,
           638,
           87522,
           81,
           839,
           306108,
           620,
           1369,
           20071,
           1884,
           35610,
           60220,
           110,
           2919,
           1230,
           110,
           519,
           186,
           184,
           318,
           69,
           52,
           196,
           137,
           2245,
           66,
           770,
           671,
           97,
           3068,
           23905,
           584,
           7370,
           392265,
           1199,
           27465,
           50,
           780,
           103653,
           93,
           4064,
           2207,
           2207,
           376312,
           246,
           1320,
           10370,
           805,
           37631,
           130142,
           183483,
           1528,
           1856,
           1343,
           23849,
           548,
           31473,
           781,
           16499,
           1030,
           49102,
           270,
           23358,
           1540,
           1194,
           7687,
           1633,
           9185,
           4891,
           731,
           1632,
           16836,
           527527,
           1205,
           1792165,
           21615,
           288389,
           1818,
           56812,
           9262,
           138184,
           24829,
           23877), 
  PGGB = c(0,
           0,
           0,
           0,
           0,
           0,
           1,
           1,
           1,
           0,
           0,
           0,
           0,
           1,
           0,
           0,
           0,
           1,
           0,
           0,
           1,
           1,
           0,
           0,
           1,
           1,
           1,
           0,
           1,
           0,
           1,
           1,
           0,
           0,
           0,
           0,
           0,
           0,
           1,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           0,
           0,
           0,
           0,
           1,
           1,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           1,
           0,
           0,
           0,
           0,
           0,
           0,
           1,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           1,
           0,
           1,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0), # Corresponding PGGB values
  Mnigraph = c(1,
               1,
               0,
               0,
               1,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               1,
               0,
               1,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               1,
               1,
               0,
               0,
               1,
               1,
               1,
               1,
               0,
               1,
               1,
               0,
               1,
               1,
               0,
               1,
               1,
               0,
               1,
               1,
               0,
               0,
               0,
               0,
               1,
               1,
               0,
               1,
               1,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               1,
               1,
               0,
               0,
               0,
               1,
               0,
               1,
               1,
               1,
               1,
               0,
               0,
               0,
               1,
               0,
               1,
               0,
               0,
               0,
               0,
               1,
               1,
               0,
               0,
               0,
               0,
               0,
               1,
               1,
               1,
               0,
               0,
               0,
               1,
               1,
               1,
               1,
               1,
               0,
               0,
               1,
               1,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0,
               0), # Corresponding Mnigraph values
  SVIM = c(0,
           0,
           1,
           1,
           0,
           1,
           0,
           0,
           1,
           0,
           0,
           1,
           1,
           0,
           0,
           1,
           1,
           0,
           1,
           1,
           0,
           0,
           1,
           0,
           0,
           0,
           0,
           1,
           0,
           1,
           0,
           0,
           0,
           1,
           1,
           1,
           1,
           1,
           0,
           1,
           1,
           0,
           1,
           1,
           0,
           0,
           0,
           0,
           1,
           0,
           1,
           0,
           0,
           0,
           0,
           1,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           1,
           0,
           0,
           1,
           0,
           0,
           1,
           1,
           0,
           1,
           0,
           0,
           0,
           0,
           1,
           0,
           1,
           0,
           0,
           0,
           1,
           1,
           1,
           0,
           1,
           0,
           1,
           0,
           1,
           0,
           0,
           0,
           0,
           1,
           0,
           0,
           0,
           0,
           0,
           1,
           0,
           1,
           0,
           1,
           0,
           1,
           0,
           0,
           0,
           0,
           0,
           0), # Corresponding SVIM values
  SyRi = c(0,
           0,
           1,
           1,
           0,
           1,
           0,
           0,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           0,
           1,
           0,
           1,
           1,
           0,
           0,
           0,
           1,
           0,
           0,
           0,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           0,
           1,
           1,
           1,
           1,
           1,
           0,
           1,
           1,
           0,
           1,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           1,
           0,
           0,
           0,
           0,
           0,
           1,
           1,
           1,
           1,
           1,
           1,
           0,
           1,
           1,
           0,
           1,
           1,
           1,
           1,
           0,
           0,
           1,
           0,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           0,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           0,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1,
           1) # Corresponding SyRi values
)

# UpSet Plot
upset(
  data,
  sets = c("PGGB", "Mnigraph", "SVIM", "SyRi"),
  order.by = "freq",
  text.scale = 1.5,
  point.size = 3
)

# Prepare for Histograms
# Pivot to long, filter for "present" (i.e. 1)
active_data <- data %>%
  pivot_longer(cols = c("PGGB", "Mnigraph", "SVIM", "SyRi"),
               names_to = "Program",
               values_to = "Presence") %>%
  filter(Presence == 1) %>%
  mutate(LogSize = log10(Size))

# Colored Log10-Size Histograms (Facet by Program) 
p <- ggplot(active_data, aes(x = LogSize, fill = Program)) +
  geom_histogram(binwidth = 0.1, color = "black", alpha = 0.7) +
  facet_wrap(~ Program, nrow = 2, scales = "free_y") +
  labs(x = "Log(Inversion Size)", y = "Frequency") +
  theme_minimal(base_size = 15) +
  theme(plot.margin = unit(c(1, 1, 3, 1), "lines")) +
  scale_fill_manual(values = c(
    "PGGB" = "lightgreen",
    "Mnigraph" = "darkgreen", 
    "SVIM" = "darkblue",
    "SyRi" = "lightblue"
  ))

print(p)

#  Annotated Custom Titles 
# 
if (interactive()) {
  library(grid)
  print(p)
  grid.text("Graph-based", x = 0.5, y = 1.0, gp = gpar(fontsize = 15, fontface = "bold"))
  grid.text("Synteny-based", x = 0.5, y = 0.52, gp = gpar(fontsize = 15, fontface = "bold"))
}

# Summary statistics
cat("Mean inversion size: ", mean(data$Size), "\n")
